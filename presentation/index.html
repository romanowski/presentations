<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">

	<title>Incremental Compiler: taming Scalac</title>
	<meta name="description" content="What is and how works incremental compiler in sbt world">
	<meta name="author" content="Krzysztof Romanowski">

	<meta name="apple-mobile-web-app-capable" content="yes"/>
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

	<meta name="viewport"
	      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

	<style type="text/css">
		.lefty {
		text-align: left;
		font-size: 65% !important;
		margin-left: 5%  !important;
		}
	</style>

	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/black.css" id="theme">

	<!-- Code syntax highlighting -->
	<link rel="stylesheet" href="lib/css/zenburn.css">

	<!-- Printing and PDF exports -->
	<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
	</script>

	<!--[if lt IE 9]>
	<script src="lib/js/html5shiv.js"></script>
	<![endif]-->
</head>

<body>

<div class="reveal">

	<!-- Any section element inside of this container is displayed as a slide -->
	<div class="slides">

		<section data-markdown>
			<script type="text/template">
			### Krzysztof Romanowski

			romanowski.kr@gmail.com

			<div style="margin-left: 36% text-align: left;">
				<img src="imgs/gh.png" style="background: none; border: none; margin: 0px"> romanowski
				<br/>
				<img src="imgs/twitter.png" style="background: none; border: none; margin: 0px"> RomanowskiKr

			</div>

			<img src="imgs/vl.png" alt="Virtus Lab" style="background: none; border: none; box-shadow: none"/>
			</script>
		</section>

		<!-- ################################################################################################################ -->

		<section>
			<section data-markdown>
				<script type="text/template">
				<div id="#"></div> Letâ€™s speed up our compilation.

				## Live profiling of zinc application.
				</script>

			</section>

			<section data-markdown>
				<script type="text/template">
				## Plan

				1. Our problem, sbt 1.0 and more fun.
				2. My app (compilation) struck. What can I do?
				3. Bigger gun. Yourkit.
				3. Profiling scala application - finding a hot spot.
				4. Bad Types. Asking for slow applications.

				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				## Scalasphere ticket!
				</script>
			</section>

		</section>

		<section>
			<section data-markdown>
				<script type="text/template">
				## Our problem, sbt 1.0 and more fun.
				</script>
			</section>


			<section data-markdown>
				<script type="text/template">
				Nothing fancy.

				Shapeless stripped of most plugins to use SBT 1.0.

				https://github.com/romanowski/shapeless/tree/profiling/problem

				<br>
				> Hello shapeless, my old friend,<br>
				> I've come to compile you again.



				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				Demo time! #1
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				## SBT 1.0, yes but why?

				1. Server!
				2. NIO
				3. Zinc (better incremental compilation)
				4. More:
					* http://eed3si9n.com/sbt-1-roadmap
					* https://github.com/sbt/sbt/projects/1
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				Demo time! #2
				</script>
			</section>
		</section>


		<!-- ################################################################################################################ -->

		<section>
			<section data-markdown>
				<script type="text/template">
				## My app (compilation) struck.
				## What can I do?
				</script>

			</section>
			<section data-markdown>
				<script type="text/template">
				### Analyze chaged code

				```
				sbt (1.0.x) > git diff 0.13 | tail
				util/process/NOTICE                                |    3 -
				util/process/src/main/scala/sbt/InheritInput.scala |   21 -
				util/process/src/main/scala/sbt/Process.scala      |  221 ----
				util/process/src/main/scala/sbt/ProcessImpl.scala  |  436 --------
				util/process/src/main/scala/sbt/SyncVar.scala      |   39 -
				.../src/test/scala/ProcessSpecification.scala      |  131 ---
				util/process/src/test/scala/TestedProcess.scala    |   46 -
				util/relation/src/main/scala/sbt/Relation.scala    |  172 ----
				util/relation/src/test/scala/RelationTest.scala    |   84 --
				1246 files changed, 18738 insertions(+), 56616 deletions(-)

				```
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				## jvisualvm

				All-in-One Java Troubleshooting Tool.

				Free.

				Preinstalled in Oracle jdk.
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				Demo time! #3
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
					<img src="imgs/tree-traverse.jpg"/>

					Correct: A, B, D, E, F, C

					Ours:	 A, B, D, E, F, E, F, D, E, F, E, F ...
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
					<img src="imgs/traverser-change.png"/>

					Found and fixed by @wpopielarski github.com/sbt/zinc/pull/193
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				## Are we done now?
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
					### How much overhead is introduced?
					<br>
					On full compilation using zinc (from sbt 1.0).

				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				<img src="imgs/slow-zinc.png"/>

				~9,7 % (I've seen cases over 20%)
				</script>
			</section>
		</section>

		<!-- ################################################################################################################ -->

		<section>
			<section data-markdown>
				<script type="text/template">
				# Bigger gun. Yourkit.
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				Demo time! #4
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				## Profiling options

				<img src="imgs/profiling-options.png"/>
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
					More in Dmitry Petrashko Scala xChange talk:

					<img src="imgs/dp.png"/>

					https://skillsmatter.com/skillscasts/8968-what-should-every-programmer-know-about-hardware-intermediate
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				Demo time! #5
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				## I can't find anything
				</script>
			</section>
		</section>

		<!--##################################################-->

		<section>

			<section data-markdown>
				<script type="text/template">
				## Where is my hotspot?
				</script>
			</section>


			<section data-markdown>
				<script type="text/template">
				## Narrow down scope!

				Demo time! #6
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				Merge callees, Focus on, merge callees, backtraces ...

				[later in the night]

				### bingo!
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
					<img src="imgs/class-caching.png"/>
				</script>
			</section>

		</section>

		<!-- ################################################################################################################ -->


		<section>

			<section data-markdown>
				<script type="text/template">
					## Bad Types.
					### Asking for slow applications.

					<br>
					> You do not know, heap like a cancer grows
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
					Demo time! #7
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				> People typing without thinking

				<img src="imgs/better-typing.png"/>
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				> premature optimization is the root of all evil
				</script>
			</section>
		</section>

		<section>

			<section data-markdown>
			<script type="text/template">
			### Krzysztof Romanowski

			romanowski.kr@gmail.com

			<div style="margin-left: 36% text-align: left;">
				<img src="imgs/gh.png" style="background: none; border: none; margin: 0px"> romanowski
				<br/>
				<img src="imgs/twitter.png" style="background: none; border: none; margin: 0px"> RomanowskiKr

			</div>

			<img src="imgs/vl.png" alt="Virtus Lab" style="background: none; border: none; box-shadow: none"/>
			</script>
		</section>
		</section>

		<!-- ################################################################################################################ -->
	</div>

</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});
</script>

</body>
</html>
adventurous
