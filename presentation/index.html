<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">

	<title>Perspective change: huge Scala project from tooling perspective</title>
	<meta name="description" content="Perspective change: huge Scala project from tooling perspective">
	<meta name="author" content="Piotr Kukielka, Krzysztof Romanowski">

	<meta name="apple-mobile-web-app-capable" content="yes"/>
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

	<meta name="viewport"
	      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

	<style type="text/css">
		.lefty {
		text-align: left;
		font-size: 65% !important;
		margin-left: 5%  !important;
		}
	</style>

	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/black.css" id="theme">

	<!-- Code syntax highlighting -->
	<link rel="stylesheet" href="lib/css/zenburn.css">

	<!-- Printing and PDF exports -->
	<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
	</script>

	<!--[if lt IE 9]>
	<script src="lib/js/html5shiv.js"></script>
	<![endif]-->
</head>

<body>

<div class="reveal">

	<!-- Any section element inside of this container is displayed as a slide -->
	<div class="slides">

		<section data-markdown>
			<script type="text/template">
			### Piotr Kukielka

			piotr.kukielka@gmail.com

			<div style="margin-left: 36% text-align: left;">
				<img src="imgs/gh.png" style="background: none; border: none; margin: 0px"> pkukielka

				<img src="imgs/twitter.png" style="background: none; border: none; margin: 0px"> pkukielka

			</div>

			<br>

			### Krzysztof Romanowski

			romanowski.kr@gmail.com

			<div style="margin-left: 36% text-align: left;">
				<img src="imgs/gh.png" style="background: none; border: none; margin: 0px"> romanowski

				<img src="imgs/twitter.png" style="background: none; border: none; margin: 0px"> RomanowskiKr

			</div>

			<img src="imgs/vl.png" alt="Virtus Lab" style="background: none; border: none; box-shadow: none"/>

			</script>
		</section>

		<!-- ################################################################################################################ -->

		<section>
			<section data-markdown>
				<script type="text/template">
				## Perspective change:
				huge Scala project from tooling perspective

				</script>

			</section>

			<section data-markdown>
				<script type="text/template">
				## Plan

				1. Tooling provisioning. Challenge bigger then it seems - Piotr
				2. Incremental. Keyword for speed and problems - Krzysztof
				3. Failures + recovery = stabliliy - ???
				4. Code quality - Piotr
				5. Tooling for support: in the search of repro- Krzysztof
				6. ??? - ???

				//kolejność do ustalenia - wpisałem losowo

				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
					This is not a presentation about sbt, CI or IDE.

				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				This is sum of expierience in providing tooling that integrate all this comoponensts.
				<br>
				<br>

				This is story how to provide scala workspaces for non-progrmers.
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				Why do we need such tooling?

				//cos trzeba na swoja obrone powiedziec
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				Presentation and examples can be found there:
				<br>

				//link do GH z gotową
				</script>
			</section>

		</section>

		<!-- ################################################################################################################ -->

		<section>
			<section data-markdown><script type="text/template">
				#Tooling provisioning

				###Challenge bigger than it seems
			</script></section>

			<section data-markdown><script type="text/template">
				###What does the 'tooling' really mean?

				* Build automation systems, build scripts
				* IDEs with proper project structure and settings
				* Additional programs being part of the ecosystem
				* CI, test and prod environments
				* Distributed builds, caches...
			</script></section>

			<section data-markdown><script type="text/template">
				<div style="text-align: center;">
					One Tooling to rule them all,<br>
					One Tooling to find them,<br>
					One Tooling to bring them all<br>
					and in the darkness bind them
				</div>
				<br>
				<div style="text-align: center;">
					<img src="imgs/One_Ring_inscription.png" style="background: none; border: none">
				</div>
			</script></section>

			<section data-markdown><script type="text/template">
				###What we have to provide?

				* Support for multiple repositories
				* Effortless upgrades and downgrades
				* Quick way to setup/reset whole environment

				Sounds easy?
			</script></section>

			<section data-markdown><script type="text/template">
				###Problems
			</script></section>

			<section data-markdown><script type="text/template">
				###No Ide is designed for that

				* Synchronization with build scripts is lacking
				* Re-generation of project structure takes minutes
				* Commandline options support is poor
			</script></section>

			<section data-markdown><script type="text/template">
				###We have to support multiple environments/workspaces
				* Dozens of environments at the same time
				* On different machines with different operating systems
				* Each can be upgraded or downgraded at any time by pull or branch change
				* Each can be fixed or restored - and depending on the failure severity it should be as quick as possible<br><br>

				####Existing solutions falls short.
			</script></section>


			<section data-markdown><script type="text/template">
				###Tooling need to reach outsie of user machine

				* Scala desperately need distributed compilation or external caching
				* Working implementation of distributed compilation in Scala does not exist
				* Caching requires a lot of resources, proper synchronization and custom extensions to your commandline and IDE build systems
			</script></section>

			<section data-markdown><script type="text/template">
				###Tooling should be able to fix itself

				With over 1M line of code and hundreds of developers:

				* IDEs will be breaking 'randomly'
				* Incremental compiler will be breaking 'randomly'
				* Everything else will... you get it :)<br><br>

				####At very least you need some way to:

				* Report the problem and make reproduction easier
				* **Fix user environment**
			</script></section>


			<section data-markdown><script type="text/template">
				###And should be smart about it

				Sure, you can always recreate whole workspace.

				But users does not like to wait.

				We try to fix only what is broken.

				The same applies for upgrades and downgrades.
			</script></section>

			<section data-markdown><script type="text/template">
				###"Entropy of an isolated system never decreases"

				###And so our fight :)
			</script></section>


		</section>
		<!-- ################################################################################################################ -->

		<section>
			<section data-markdown>
				<script type="text/template">
				2.1
				</script>

			</section>

			<section data-markdown>
				<script type="text/template">
				2.2
				</script>

			</section>

		</section>
		<!-- ################################################################################################################ -->

		<section>
			<section data-markdown>
				<script type="text/template">
				3.1
				</script>

			</section>

			<section data-markdown>
				<script type="text/template">
				3.2
				</script>

			</section>

		</section>
		<!-- ################################################################################################################ -->

		<section>
			<section data-markdown>
				<script type="text/template">
				4.1
				</script>

			</section>

			<section data-markdown>
				<script type="text/template">
				4.2

				aas
				</script>

			</section>

		</section>
		<!-- ################################################################################################################ -->

		<section>
			<section data-markdown>
				<script type="text/template">
                Tooling for support: in the search of repro


                Problems: reporting takes over solving
				</script>

			</section>


			<section data-markdown>
				<script type="text/template">
				Usual thread on support mailing list
				</script>

			</section>

			<section data-markdown>
				<script type="text/template">
				<div style="text-align: left;">

				_I changed leaf project then compiled, but when I tried to run my application it compiled whole workspace._
				</div>
				<br>
				<div style="text-align: right;">
				_Can you give me more details?<br> Version of platform-X, branch/repository, installation detalis_
				</div>
				<br>
				<div style="text-align: left;">
				_Where I can find version of platform-X?_
				</div>

				... After multiple messages sent...

				<div style="text-align: right;">
					_Sorry I cannot reproduce your problem._
				</div>
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				Similar problem was reported multiple times.

				After hours spent of searching for repeatable repro problem was finally found and reported.

				```scala
				//Inside project A
				trait X

				class A
				//commenting this line affacting ClassAsGenericBoundUsage on X
				extends X

				//Inside project B that depends on A

				//This class will be compiled when line 5 is commented
				class B {
				//this has ClassAsGenericBoundUsage on X
					def foo: Option[X] = None
				}
				```
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				Usually without reproduction cause cannot be found,<br/>so problem cannot be properly fixed/reported.

				### How to find reproduction?

				Tools always work at creator's machine...
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				Problem with repros: even really small detail can matter

				<img src="imgs/evenSmallDetali.png" style="background: none; border: none">


				https://youtrack.jetbrains.com/issue/SCL-9532
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				## Wishful thinking...

				<img src="imgs/steps-sbt.png" style="background: none; border: none">
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				## Manual approach

				In the end tooling developer needs to find repro himself/herslelf.

				The only think that can be approved is how many work needs to be put here.
				</script>
			</section>


			<section data-markdown>
				<script type="text/template">
				## Error reports

				1. Easy for end user: one click + short description
				2. Powerful for developer: contains as much information as possible
				3. Legal issues: cannot expose non-public code
				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				## Statistics gathering

				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				## Self-diagnostic tools

				1. Deadlock detetction (from Intellij)
				2. Tweaks in ScalaIDE (named compilation threads)
				3. API Changes from SBT's name hashing

				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				## Beware! Support tools can break your tooling

				1. Problems with namehashing api changes
				2. Deadlock detection that breaks long compilations
				3. Time losses on tracking

				</script>
			</section>

			<section data-markdown>
				<script type="text/template">
				## We kindy ask for:

				1. Possibilty to log as much as possible.
					What was compiled, what trigger change etc. We want to know what happens inside problematic ws!
					//task for intellij - sbt as example
				2. Allow us to easly connect with debugger. Intellij's compilePort FTW!
				3. Time loss on tracking

				</script>
			</section>

		</section>
		<!-- ################################################################################################################ -->

		<section>
			<section data-markdown>
				<script type="text/template">
				6.1
				</script>

			</section>

			<section data-markdown>
				<script type="text/template">
				6.2
				</script>

			</section>

		</section>
		<!-- ################################################################################################################ -->


		<section>
			<section data-markdown>
				<script type="text/template">
				Podsumowanie 1
				</script>

			</section>

			<section data-markdown>
				<script type="text/template">
				Podsumowanie 2
				</script>

			</section>

		</section>
		<!-- ################################################################################################################ -->

		<section>

			<section data-markdown>
				<script type="text/template">
				<!--to jest kopia 1 slajdu-->
				### Piotr Kukielka

				piotr.kukielka@gmail.com

				<div style="margin-left: 36% text-align: left;">
					<img src="imgs/gh.png" style="background: none; border: none; margin: 0px"> pkukielka

					<img src="imgs/twitter.png" style="background: none; border: none; margin: 0px"> pkukielka

				</div>

				<br>

				### Krzysztof Romanowski

				romanowski.kr@gmail.com

				<div style="margin-left: 36% text-align: left;">
					<img src="imgs/gh.png" style="background: none; border: none; margin: 0px"> romanowski

					<img src="imgs/twitter.png" style="background: none; border: none; margin: 0px"> RomanowskiKr

				</div>

				<img src="imgs/vl.png" alt="Virtus Lab" style="background: none; border: none; box-shadow: none"/>

				</script>
			</section>
		</section>

		<!-- ################################################################################################################ -->
	</div>

</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});











</script>

</body>
</html>
